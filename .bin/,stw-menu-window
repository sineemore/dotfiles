#!/bin/sh

set -eu

if [ $# -eq 1 ] && [ "$1" = "run" ]; then
    exec stw \
        -f 'monospace:size=8' \
        -c 'black,#cccccc,white,black' \
        -ar \
        -g -0,15 \
        -b8 \
        -p60 \
        -r '\[[^]]+\]|![^ ]+' \
        "$0"
fi

cat <<'EOF'
░▒▓███████▓▒░ ░▒▓██████▓▒░░▒▓███████▓▒░       ░▒▓█▓▒░░▒▓█▓▒░░▒▓███████▓▒░▒▓████████▓▒░▒▓███████▓▒░  
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓███████▓▒░░▒▓████████▓▒░▒▓█▓▒░░▒▓█▓▒░  =c  ░▒▓█▓▒░░▒▓█▓▒░░▒▓██████▓▒░░▒▓██████▓▒░ ░▒▓███████▓▒░  
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░ 
░▒▓███████▓▒░░▒▓█▓▒░░▒▓█▓▒░▒▓███████▓▒░        ░▒▓██████▓▒░░▒▓███████▓▒░░▒▓████████▓▒░▒▓█▓▒░░▒▓█▓▒░ 
EOF

cmd="${STW_SELECTED:-}"
headphones="AC:80:0A:C5:B2:9E"

case "$cmd" in
"[poweroff]")
    sudo poweroff
    ;;
"[X]")
    pkill -x Xorg
    ;;
"!"*)
    r="${cmd#!}"
    nohup $r >/dev/null 2>&1 &
    ;;
"$(,stw-bluetooth match "$headphones")") ,stw-bluetooth run "$headphones" ;;
"$(,stw-darkman match)")                 ,stw-darkman run                 ;;
esac

cat <<EOF
$(,stw-bluetooth draw "$headphones") !,xgray $(,stw-darkman draw) [poweroff] [X]
!google-chrome-stable
EOF
